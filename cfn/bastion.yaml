AWSTemplateFormatVersion: "2010-09-09"
Description: EC2 instance for Bastion

Parameters:
  PublicSubnetID:
    Type: AWS::EC2::Subnet::Id
    Description: The ID of the Public Subnet
  BastionSGID:
    Type: AWS::EC2::SecurityGroup::Id
    Description: The ID of the Bastion Security Group
  KeyName:
    Type: AWS::EC2::KeyPair::KeyName
    Description: The name of the Key Pair

Resources:
  BastionInstance:
    Type: AWS::EC2::Instance
    Properties:
      InstanceType: t2.medium
      SecurityGroupIds:
        - !Ref BastionSGID
      SubnetId: !Ref PublicSubnetID
      ImageId: ami-01bef798938b7644d  # Ubuntu Server 24.04 LTS
      KeyName: !Ref KeyName
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            VolumeSize: 32
            VolumeType: gp3
      Tags:
        - Key: Name
          Value: !Sub "bastion-${AWS::StackName}"
