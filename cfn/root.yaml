AWSTemplateFormatVersion: '2010-09-09'
Description: Chatbot Arena Infrastructure

Parameters:
  FastChatECRRepositoryName:
    Type: String
    Description: ECR Repository name for FastChat
    Default: fastchat

Resources:
  VPCStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: ./vpc.yaml

  SecurityGroupsStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: ./security_groups.yaml
      Parameters:
        VPCID: !GetAtt VPCStack.Outputs.VPCID

  ClusterStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: ./cluster.yaml
      Parameters:
        VPCID: !GetAtt VPCStack.Outputs.VPCID
        PublicSubnetID: !GetAtt VPCStack.Outputs.PublicSubnetID
        PublicSubnet2ID: !GetAtt VPCStack.Outputs.PublicSubnet2ID
        PrivateSubnetID: !GetAtt VPCStack.Outputs.PrivateSubnetID
        PrivateSubnet2ID: !GetAtt VPCStack.Outputs.PrivateSubnet2ID
        FastChatECRRepositoryName: !Ref FastChatECRRepositoryName
        ControllerSGID: !GetAtt SecurityGroupsStack.Outputs.ControllerSGID
        GradioSGID: !GetAtt SecurityGroupsStack.Outputs.GradioSGID
        ControllerALBSGID: !GetAtt SecurityGroupsStack.Outputs.ControllerALBSGID
        GradioALBSGID: !GetAtt SecurityGroupsStack.Outputs.GradioALBSGID
